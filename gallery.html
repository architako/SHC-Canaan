<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="icon" type="image/png" href="favicon.png">

  <meta charset="UTF-8" />
  <title>ألبوم الصور - مخيم الهلال الجنوبي -كنعان-</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- خط Cairo -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #0b5a84;
      --primary-light: #e6f2f8;
      --text: #222;
      --muted: #777;
      --bg: #f5f5f5;
      --card-bg: #ffffff;
    }

    * { box-sizing: border-box; }

    body {
  margin: 0;
  font-family: "Cairo", system-ui, -apple-system, "Segoe UI", sans-serif;
  background-color: var(--bg);
  color: var(--text);
  direction: rtl;
}


    a { color: inherit; text-decoration: none; }

    /* ===== الهيدر + المنيو ===== */

    header.site-header {
      background-color: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-top {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 16px;
      border-bottom: 1px solid #eee;
    }

    .header-logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-logo img {
      height: 80px;
      width: auto;
      object-fit: contain;
    }

    .header-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--primary);
    }

    nav.main-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 16px;
    }

    nav.main-nav a {
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.9rem;
      color: var(--primary);
      background-color: transparent;
      border: 1px solid transparent;
      cursor: pointer;
    }

    nav.main-nav a:hover {
      background-color: var(--primary-light);
    }

    nav.main-nav a.active {
      background-color: var(--primary);
      color: #ffffff;
      border-color: var(--primary);
      font-weight: 600;
    }

    /* ===== محتوى الصفحة ===== */

    main {
      max-width: 1100px;
      margin: 20px auto 40px;
      padding: 0 16px;
    }

    .page-header {
      margin-bottom: 20px;
    }

    .page-header h1 {
      margin: 0 0 6px;
      font-size: 1.4rem;
    }

    .page-header p {
      margin: 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    /* ===== ألبوم الصور ===== */

    .albums-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 14px;
      margin-top: 14px;
    }

    .album-card {
      background-color: var(--card-bg);
      border-radius: 14px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background-color 0.1s ease;
      border: 1px solid transparent;
    }

    .album-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      background-color: #fdfefe;
      border-color: var(--primary-light);
    }

    .album-thumb {
      width: 100%;
      height: 150px;
      background-color: var(--primary-light);
      overflow: hidden;
    }

    .album-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .album-body {
      padding: 10px 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .album-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      color: var(--primary);
    }

    .album-meta {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .album-desc {
      font-size: 0.9rem;
      color: var(--text);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .album-footer {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .status-message {
      text-align: center;
      color: var(--muted);
      font-size: 0.9rem;
      padding: 20px 0;
    }

    footer.site-footer {
      text-align: center;
      font-size: 0.8rem;
      color: #ffffff;
      background-color: var(--primary);
      padding: 8px;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      .header-top {
        flex-direction: row;
        justify-content: space-between;
      }
      nav.main-nav {
        padding-top: 4px;
        padding-bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-top">
      <div class="header-logo">
        <img src="LOGO.png" alt="شعار مخيم الهلال الجنوبي -كنعان-">
        <div class="header-title">مخيم الهلال الجنوبي -كنعان-</div>
      </div>
    </div>
    <nav class="main-nav">
      <a href="index.html">الصفحة الرئيسية</a>
      <a href="events.html">آخر الفعاليات</a>
      <a href="admins.html">أعضاء الإدارة</a>
      <a href="services.html">الخدمات الإلكترونية</a>
      <a href="gallery.html" class="active">ألبوم الصور</a>
    </nav>
  </header>

  <main>
    <section class="page-header">
      <h1>ألبوم الصور</h1>
    </section>

    <section id="gallery-section">
      <div id="gallery-status" class="status-message">جاري تحميل ألبوم الصور...</div>
      <div id="albums-container" class="albums-grid" style="display:none;"></div>
    </section>
  </main>

  <footer class="site-footer">
    جميع الحقوق محفوظة &copy; مخيم الهلال الجنوبي -كنعان-  &copy;  تصميم م. أحمد ماضي 
  </footer>

  <script>
    // رابط CSV لورقة "ألبوم الصور"
    const GALLERY_CSV_URL =
      'https://docs.google.com/spreadsheets/d/e/2PACX-1vTv_Ow-CBTJPbYNSVivDuG_MPM9w-Ov6xwVdLux0-FE7eX_y8RCVpF32bLNsSTZwb5jlMTfa9lmSXIP/pub?gid=1085535145&single=true&output=csv';

    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      return lines.map(line => line.split(',').map(cell => cell.trim()));
    }

    function getHeaderIndex(headers, name) {
      return headers.indexOf(name);
    }

    function buildGalleryView(rows) {
      const statusEl = document.getElementById('gallery-status');
      const container = document.getElementById('albums-container');

      if (!rows || rows.length <= 1) {
        statusEl.textContent = 'لا توجد ألبومات مفعّلة حالياً.';
        return;
      }

      const header = rows[0];

      const idxId      = getHeaderIndex(header, 'id');
      const idxTitle   = getHeaderIndex(header, 'العنوان');
      const idxDesc    = getHeaderIndex(header, 'الوصف');
      const idxDate    = getHeaderIndex(header, 'التاريخ');
      const idxImage   = getHeaderIndex(header, 'صورة (رابط مباشر)');
      const idxAlbum   = getHeaderIndex(header, 'رابط الألبوم');
      const idxActive  = getHeaderIndex(header, 'مفعّل؟');
      const idxOrder   = getHeaderIndex(header, 'ترتيب');

      if (idxTitle === -1 || idxOrder === -1) {
        statusEl.textContent = 'لم يتم العثور على العناوين المتوقعة في الشيت لألبوم الصور.';
        console.log('HEADER ROW:', header);
        return;
      }

      const albums = [];

      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        if (!row || row.length === 0) continue;

        const activeVal = idxActive >= 0 ? (row[idxActive] || '') : '';
        if (!String(activeVal).trim()) continue;

        const orderVal = idxOrder >= 0 ? (row[idxOrder] || '') : '';
        if (!String(orderVal).trim()) continue;

        const album = {
          id:     idxId    >= 0 ? row[idxId]    : '',
          title:  idxTitle >= 0 ? row[idxTitle] : '',
          desc:   idxDesc  >= 0 ? row[idxDesc]  : '',
          date:   idxDate  >= 0 ? row[idxDate]  : '',
          image:  idxImage >= 0 ? row[idxImage] : '',
          link:   idxAlbum >= 0 ? row[idxAlbum] : '',
          order:  orderVal
        };

        albums.push(album);
      }

      if (albums.length === 0) {
        statusEl.textContent = 'لا توجد ألبومات مفعّلة حالياً.';
        return;
      }

      // ترتيب حسب "ترتيب"
      albums.sort((a, b) => {
        const na = Number(a.order);
        const nb = Number(b.order);
        if (!isNaN(na) && !isNaN(nb)) return na - nb;
        return String(a.order).localeCompare(String(b.order), 'ar');
      });

      container.innerHTML = '';

      albums.forEach(album => {
        const card = document.createElement('article');
        card.className = 'album-card';

        // إذا يوجد رابط ألبوم، اجعل الكرت كله قابل للضغط
        if (album.link && album.link.startsWith('http')) {
          card.addEventListener('click', () => {
            window.open(album.link, '_blank', 'noopener');
          });
        }

        // صورة الغلاف
        if (album.image && album.image.startsWith('http')) {
          const thumb = document.createElement('div');
          thumb.className = 'album-thumb';
          const img = document.createElement('img');
          img.src = album.image;
          img.alt = album.title || 'صورة الألبوم';
          thumb.appendChild(img);
          card.appendChild(thumb);
        }

        const body = document.createElement('div');
        body.className = 'album-body';

        const titleEl = document.createElement('h2');
        titleEl.className = 'album-title';
        titleEl.textContent = album.title || '';

        const metaEl = document.createElement('div');
        metaEl.className = 'album-meta';
        if (album.date) metaEl.textContent = 'التاريخ: ' + album.date;

        const descEl = document.createElement('div');
        descEl.className = 'album-desc';
        const fullDesc = album.desc || '';
        const maxLen = 140;
        descEl.textContent = fullDesc.length > maxLen
          ? fullDesc.slice(0, maxLen) + '…'
          : fullDesc;

        const footerEl = document.createElement('div');
        footerEl.className = 'album-footer';
        if (album.link && album.link.startsWith('http')) {
          footerEl.textContent = 'انقر لفتح الألبوم في نافذة جديدة.';
        } else {
          footerEl.textContent = 'لا يوجد رابط ألبوم محدد.';
        }

        body.appendChild(titleEl);
        if (album.date) body.appendChild(metaEl);
        if (fullDesc) body.appendChild(descEl);
        body.appendChild(footerEl);

        card.appendChild(body);
        container.appendChild(card);
      });

      statusEl.style.display = 'none';
      container.style.display = 'grid';
    }

    async function loadGallery() {
      const statusEl = document.getElementById('gallery-status');

      if (!GALLERY_CSV_URL) {
        statusEl.textContent = 'يرجى ضبط رابط CSV الخاص بورقة "ألبوم الصور" داخل الكود.';
        return;
      }

      try {
        const res = await fetch(GALLERY_CSV_URL);
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const text = await res.text();
        const rows = parseCSV(text);
        buildGalleryView(rows);
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'حدث خطأ أثناء تحميل بيانات ألبوم الصور. يرجى التأكد من رابط الشيت.';
      }
    }

    document.addEventListener('DOMContentLoaded', loadGallery);
  </script>
</body>
</html>
