<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بياناتك - مخيم الهلال الجنوبي</title>

  <!-- استدعاء خط Cairo من Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --green:   #B8DFAF;
      --brown:   #7A5330;
      --dark:    #2F2F2F;
      --light:   #FFFFFF;
      --soft:    #D9EBD4;
    }

    body {
      font-family: "Cairo", Tahoma, Arial, sans-serif;
      background: #B78C5A; /* نفس خلفية الصفحة الأولى */
      color: var(--light);
      text-align:center;
      margin:0;
      padding:0;
    }

    .box {
      background: var(--dark);
      padding:20px;
      border-radius:15px;
      border:3px solid var(--green);
      margin:20px auto;
      width:96%;
      max-width:900px;
      box-sizing:border-box;
    }

    .logo {
      width:120px;
      margin-bottom:10px;
    }

    h3 { 
      color: var(--green); 
      text-align:center; 
      margin:5px 0 10px;
      font-size:22px;
      font-weight:700;
    }

    .info {
      font-size:14px;
      margin-bottom:10px;
      color: var(--soft);
      text-align:center;
    }

    .error {
      color:#ff7675;
      text-align:center;
      margin:20px 0;
      font-size:14px;
    }

    .frame-wrapper {
      position: relative;
      width:100%;
      height:600px;
      margin-top:10px;
      border-radius:10px;
      overflow:hidden;
      background:#111;
      box-sizing:border-box;
    }

    iframe {
      width:100%;
      height:100%;
      border:none;
      display:none; /* يُظهر بعد التحميل */
    }

    .loader-overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.45);
    }

    .loader-text {
      margin-top:10px;
      color:var(--green);
      font-size:14px;
      text-align:center;
    }

    .spinner {
      width:40px;
      height:40px;
      border-radius:50%;
      border:4px solid var(--green);
      border-top-color:transparent;
      animation:spin 1s linear infinite;
      margin:0 auto;
    }

    @keyframes spin {
      to { transform:rotate(360deg); }
    }

    .actions {
      margin-top:15px;
      text-align:center;
    }

    .btn {
      display:inline-block;
      padding:8px 16px;
      margin:4px;
      border-radius:20px;
      border:none;
      cursor:pointer;
      font-weight:bold;
      text-decoration:none;
      font-size:14px;
      box-sizing:border-box;
    }

    .btn-back  { background:var(--green); color:var(--brown); }
    .btn-link  { background:#555;        color:#fff;      }

    .btn-back:hover {
      background:var(--soft);
    }
    .btn-link:hover {
      background:#666;
    }

    @media (max-width: 600px) {
      .box {
        margin:10px auto;
        padding:15px;
      }
      h3 { font-size:20px; }
      .info { font-size:13px; }
      .error { font-size:13px; }

      .frame-wrapper {
        height:420px;
      }

      .btn {
        width:100%;
        font-size:13px;
      }
    }

    @media (max-width: 400px) {
      .frame-wrapper {
        height:360px;
      }
    }
  </style>
</head>
<body>

  <div class="box">
    <!-- الشعار -->
    <img src="LOGO.png" class="logo" alt="مخيم الهلال الجنوبي">

    <h3>بياناتك المسجّلة</h3>

    <div class="info" id="info"></div>
    <div id="error" class="error"></div>

    <div class="frame-wrapper">
      <div id="loader" class="loader-overlay">
        <div>
          <div class="spinner"></div>
          <div class="loader-text">جاري تحميل البيانات، يرجى الانتظار...</div>
        </div>
      </div>

      <iframe id="dataFrame"></iframe>
    </div>

    <div class="actions">
      <a href="index.html" class="btn btn-back">⬅ العودة لصفحة تسجيل الدخول</a>
      <a href="https://chat.whatsapp.com/XXXXX" target="_blank" class="btn btn-link">قروب الواتساب</a>
      <a href="https://facebook.com/XXXXX" target="_blank" class="btn btn-link">صفحة الفيس بوك</a>
    </div>
  </div>

  <script>
    // رابط الويب آب الداخلي من Apps Script
    const INNER_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzJ_P5IcL2-jlBq5Y_v8cgO_1pyF_bflQJHrFTG8sC0ofCFZvHmpLz5ShZ9YxdveTuG/exec';

    const params = new URLSearchParams(window.location.search);
    const nid   = params.get('national_id') || '';
    const phone = params.get('phone') || '';

    const infoEl   = document.getElementById('info');
    const errorEl  = document.getElementById('error');
    const frame    = document.getElementById('dataFrame');
    const loader   = document.getElementById('loader');

    if (!nid || !phone) {
      errorEl.textContent = 'تم فتح الصفحة بدون بيانات تسجيل الدخول. الرجاء العودة وإدخال البيانات من جديد.';
      if (loader) loader.style.display = 'none';
    } else {
      infoEl.innerHTML = 
        'تم الدخول باستخدام رقم الهوية: <strong>' + nid +
        '</strong> و آخر 4 أرقام من رقم الجوال: <strong>' + phone + '</strong>.';

      const url = INNER_WEBAPP_URL +
        '?national_id=' + encodeURIComponent(nid) +
        '&phone='       + encodeURIComponent(phone);

      frame.src = url;

      frame.onload = function() {
        if (loader) loader.style.display = 'none';
        frame.style.display = 'block';
      };
    }
  </script>

</body>
</html>
